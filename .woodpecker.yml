---
branches: main

clone:
  git:
    image: woodpeckerci/plugin-git
    settings:
      recursive: true

pipeline:
  build:
    image: registry.gitlab.com/pages/hugo/hugo_extended:latest
    commands:
      - hugo

  publish:
    image: git.shrug.pw/neil/containers/woodpecker-ci:latest
    secrets: [ssh_key]
    environment:
      - GIT_AUTHOR_NAME="Woody the Woodpecker"
      - GIT_AUTHOR_EMAIL=ci@shrug.pw
    commands:
      - mkdir -p  ~/.ssh/
      - echo "$SSH_KEY" > ~/.ssh/id_rsa
      - chmod 0700 ~/.ssh/
      - chmod 0600 ~/.ssh/id_rsa
      - bash deploy.sh
